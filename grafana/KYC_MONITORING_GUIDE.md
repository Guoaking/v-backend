# KYCä¼ä¸šçº§ç›‘æ§ä»ªè¡¨æ¿é…ç½®æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†4ä¸ªå…¨é¢çš„ã€å·¥ç¨‹åŒ–çš„Grafanaç›‘æ§ä»ªè¡¨æ¿ï¼Œä¸“é—¨é’ˆå¯¹KYCä¼ä¸šè®¤è¯æœåŠ¡çš„æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡ã€æƒé™ç®¡ç†ã€APIæ€§èƒ½å’Œè¿è¥åˆ†æè¿›è¡Œç›‘æ§ã€‚

## ä»ªè¡¨æ¿æ¸…å•

### 1. KYCæ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡ç›‘æ§ (`kyc-core-business-dashboard.json`)
**ç”¨é€”**: ç›‘æ§KYCæ ¸å¿ƒä¸šåŠ¡æµç¨‹çš„å¥åº·çŠ¶å†µ
**å…³é”®æŒ‡æ ‡**:
- KYCè®¤è¯æˆåŠŸç‡ (ç›®æ ‡: >95%)
- æ€»è®¤è¯é‡ (QPS)
- OCRè¯†åˆ«æˆåŠŸç‡ (ç›®æ ‡: >98%)
- äººè„¸è¯†åˆ«æˆåŠŸç‡ (ç›®æ ‡: >95%)
- ä¸šåŠ¡æ“ä½œæ€§èƒ½åˆ†æ (P50/P95å“åº”æ—¶é—´)
- é”™è¯¯ç‡è¶‹åŠ¿å’Œåˆ†å¸ƒ

**é¢æ¿å¸ƒå±€**:
- ä¸šåŠ¡æ¦‚è§ˆè¡Œ: æ ¸å¿ƒKPIæŒ‡æ ‡
- æˆåŠŸç‡è¶‹åŠ¿å›¾: å®æ—¶ç›‘æ§å„ä¸šåŠ¡çº¿æˆåŠŸç‡
- ä¸šåŠ¡é‡è¶‹åŠ¿å›¾: è®¤è¯è¯·æ±‚é‡å˜åŒ–
- æ€§èƒ½åˆ†æ: å“åº”æ—¶é—´åˆ†å¸ƒ
- é”™è¯¯åˆ†æ: å¤±è´¥åŸå› å’Œè¶‹åŠ¿

### 2. RBACæƒé™ç®¡ç†ç›‘æ§ (`kyc-rbac-monitoring-dashboard.json`)
**ç”¨é€”**: ç›‘æ§æƒé™ç®¡ç†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œæ€§èƒ½
**å…³é”®æŒ‡æ ‡**:
- ç®¡ç†å‘˜æ“ä½œæˆåŠŸç‡
- æƒé™æ‹’ç»æ¬¡æ•° (å¼‚å¸¸è®¿é—®æ£€æµ‹)
- æ´»è·ƒç®¡ç†å‘˜æ•°é‡
- å„ç±»ç®¡ç†å‘˜æ“ä½œåˆ†å¸ƒ
- æƒé™é”™è¯¯è¶‹åŠ¿
- å®‰å…¨äº‹ä»¶åˆ†æ

**é¢æ¿å¸ƒå±€**:
- æƒé™ç®¡ç†æ¦‚è§ˆ: æ ¸å¿ƒå®‰å…¨æŒ‡æ ‡
- ç®¡ç†å‘˜æ“ä½œè¶‹åŠ¿: å„ç±»ç®¡ç†æ“ä½œç»Ÿè®¡
- æƒé™é”™è¯¯åˆ†æ: æƒé™æ‹’ç»å’Œå¼‚å¸¸è®¿é—®
- æ€§èƒ½ç›‘æ§: ç®¡ç†å‘˜æ“ä½œå“åº”æ—¶é—´
- å®‰å…¨äº‹ä»¶: å¼‚å¸¸æ¨¡å¼è¯†åˆ«

### 3. APIæ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿ (`kyc-api-performance-dashboard.json`)
**ç”¨é€”**: ç›‘æ§APIç½‘å…³å’ŒæœåŠ¡çš„æ€§èƒ½æŒ‡æ ‡
**å…³é”®æŒ‡æ ‡**:
- æ€»è¯·æ±‚QPS
- å¹³å‡å“åº”æ—¶é—´ (P95)
- HTTPæˆåŠŸç‡ (ç›®æ ‡: >99%)
- æœ€æ…¢ç«¯ç‚¹æ’è¡Œ
- æœ€é«˜QPSç«¯ç‚¹
- é”™è¯¯ç‡åˆ†å¸ƒ

**é¢æ¿å¸ƒå±€**:
- APIæ€§èƒ½æ¦‚è§ˆ: æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡
- QPSè¶‹åŠ¿å›¾: è¯·æ±‚é‡å˜åŒ–
- å“åº”æ—¶é—´åˆ†å¸ƒ: P50/P95/P99è¶‹åŠ¿
- ç«¯ç‚¹æ€§èƒ½åˆ†æ: æœ€æ…¢å’Œæœ€é«˜è´Ÿè½½ç«¯ç‚¹
- é”™è¯¯åˆ†æ: HTTPçŠ¶æ€ç åˆ†å¸ƒå’Œé”™è¯¯è¶‹åŠ¿

### 4. ä¸šåŠ¡è¿è¥åˆ†æä»ªè¡¨æ¿ (`kyc-business-operations-dashboard.json`)
**ç”¨é€”**: åˆ†æä¸šåŠ¡è¿è¥æ•°æ®å’Œç”¨æˆ·è¡Œä¸º
**å…³é”®æŒ‡æ ‡**:
- æ—¥æ´»ç”¨æˆ· (DAU)
- æ€»è®¤è¯é‡ (æ—¥/å‘¨/æœˆ)
- è®¤è¯æˆåŠŸç‡è¶‹åŠ¿
- ç”¨æˆ·æ´»è·ƒåº¦çƒ­åŠ›å›¾
- ä¸šåŠ¡é”™è¯¯åˆ†æ
- KPIæŒ‡æ ‡ (å¢é•¿ç‡ã€ç•™å­˜ç‡)

**é¢æ¿å¸ƒå±€**:
- è¿è¥æ¦‚è§ˆ: æ ¸å¿ƒè¿è¥æŒ‡æ ‡
- ç”¨æˆ·æ´»è·ƒåº¦: DAUå’Œç”¨æˆ·è¡Œä¸º
- è®¤è¯é‡è¶‹åŠ¿: ä¸šåŠ¡é‡å˜åŒ–
- æˆåŠŸç‡åˆ†æ: å„ä¸šåŠ¡çº¿å¯¹æ¯”
- ç”¨æˆ·è¡Œä¸ºåˆ†æ: æ“ä½œåˆ†å¸ƒå’Œé”™è¯¯ç»Ÿè®¡
- KPIæŒ‡æ ‡: å¢é•¿ç‡å’Œç•™å­˜ç‡

## æŠ€æœ¯ç‰¹æ€§

### å·¥ç¨‹åŒ–è®¾è®¡
1. **æ ‡å‡†åŒ–æŒ‡æ ‡**: åŸºäºOpenTelemetryåŸ‹ç‚¹æ•°æ®
2. **æ™ºèƒ½é˜ˆå€¼**: æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è®¾ç½®å‘Šè­¦é˜ˆå€¼
3. **å¤šç»´åº¦åˆ†æ**: æ”¯æŒæŒ‰æ—¶é—´ã€ç«¯ç‚¹ã€ç”¨æˆ·ç­‰å¤šç»´åº¦ç­›é€‰
4. **å®æ—¶æ›´æ–°**: 15-30ç§’è‡ªåŠ¨åˆ·æ–°
5. **ä¸­æ–‡ç•Œé¢**: ç¬¦åˆå›½å†…ä¼ä¸šä½¿ç”¨ä¹ æƒ¯

### æ•°æ®æºé…ç½®
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin123)
- **æœåŠ¡æŒ‡æ ‡**: http://localhost:8082/metrics

### å…³é”®æŒ‡æ ‡è¯´æ˜

#### ä¸šåŠ¡æŒ‡æ ‡
```promql
# KYCè®¤è¯æˆåŠŸç‡
rate(business_operations_total{operation=~"kyc_.*",status="success"}[5m]) / rate(business_operations_total{operation=~"kyc_.*"}[5m]) * 100

# OCRè¯†åˆ«æˆåŠŸç‡
rate(business_operations_total{operation="ocr",status="success"}[5m]) / rate(business_operations_total{operation="ocr"}[5m]) * 100

# äººè„¸è¯†åˆ«æˆåŠŸç‡
rate(business_operations_total{operation="face_verify",status="success"}[5m]) / rate(business_operations_total{operation="face_verify"}[5m]) * 100
```

#### æ€§èƒ½æŒ‡æ ‡
```promql
# P95å“åº”æ—¶é—´
histogram_quantile(0.95, rate(business_operation_duration_seconds_bucket[5m]))

# API P95å“åº”æ—¶é—´
histogram_quantile(0.95, rate(http_request_duration_p95_seconds_bucket[5m]))
```

#### è¿è¥æŒ‡æ ‡
```promql
# æ—¥æ´»ç”¨æˆ·
count(count by (user_id) (business_operations_total{operation=~"get_user_profile|admin_user_list|admin_org_list"}[24h]))

# æ€»è®¤è¯é‡
sum(increase(business_operations_total{operation=~"kyc_.*"}[1d]))
```

## éƒ¨ç½²å’Œä½¿ç”¨

### å¿«é€Ÿéƒ¨ç½²
```bash
# 1. å¯¼å…¥æ‰€æœ‰ä»ªè¡¨æ¿
./scripts/import-dashboards.sh

# 2. éªŒè¯å¯¼å…¥ç»“æœ
# è®¿é—® http://localhost:3000 æŸ¥çœ‹å¯¼å…¥çš„ä»ªè¡¨æ¿
```

### æ‰‹åŠ¨å¯¼å…¥
1. ç™»å½•Grafana: http://localhost:3000
2. å¯¼èˆªåˆ° "Dashboards" â†’ "Import"
3. ä¸Šä¼ JSONæ–‡ä»¶æˆ–ç²˜è´´å†…å®¹
4. é€‰æ‹©Prometheusæ•°æ®æº
5. ç‚¹å‡» "Import"

### è‡ªå®šä¹‰é…ç½®
- **æ—¶é—´èŒƒå›´**: é»˜è®¤1å°æ—¶ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´
- **åˆ·æ–°é¢‘ç‡**: 15-30ç§’ï¼Œæ”¯æŒè‡ªå®šä¹‰
- **é˜ˆå€¼è®¾ç½®**: æ ¹æ®ä¸šåŠ¡SLAè°ƒæ•´å‘Šè­¦é˜ˆå€¼
- **å˜é‡ç­›é€‰**: æ”¯æŒæŒ‰ç«¯ç‚¹ã€æ–¹æ³•ã€çŠ¶æ€ç ç­›é€‰

## å‘Šè­¦å»ºè®®

### å…³é”®å‘Šè­¦è§„åˆ™
```yaml
# ä¸šåŠ¡æˆåŠŸç‡å‘Šè­¦
- alert: KYCSuccessRateLow
  expr: rate(business_operations_total{operation=~"kyc_.*",status="success"}[5m]) / rate(business_operations_total{operation=~"kyc_.*"}[5m]) * 100 < 90
  for: 2m
  labels:
    severity: critical
  annotations:
    summary: "KYCè®¤è¯æˆåŠŸç‡ä½äº90%"

# APIå“åº”æ—¶é—´å‘Šè­¦
- alert: APIResponseTimeHigh
  expr: histogram_quantile(0.95, rate(http_request_duration_p95_seconds_bucket[5m])) > 2
  for: 5m
  labels:
    severity: warning
  annotations:
    summary: "API P95å“åº”æ—¶é—´è¶…è¿‡2ç§’"

# æƒé™æ‹’ç»å‘Šè­¦
- alert: PermissionDeniedSpike
  expr: rate(business_operations_total{error_type="permission_denied"}[1m]) > 0.1
  for: 1m
  labels:
    severity: warning
  annotations:
    summary: "æƒé™æ‹’ç»æ¬¡æ•°å¼‚å¸¸å¢åŠ "
```

## ç»´æŠ¤å’Œä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–
- åˆç†è®¾ç½®æŸ¥è¯¢æ—¶é—´èŒƒå›´
- ä½¿ç”¨recording rulesé¢„è®¡ç®—å¤æ‚æŸ¥è¯¢
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
- ä¼˜åŒ–PrometheusæŸ¥è¯¢æ€§èƒ½

### ç›‘æ§ç»´æŠ¤
- å®šæœŸæ£€æŸ¥ä»ªè¡¨æ¿å‡†ç¡®æ€§
- æ ¹æ®ä¸šåŠ¡å˜åŒ–æ›´æ–°æŒ‡æ ‡
- ç›‘æ§ä»ªè¡¨æ¿åŠ è½½æ€§èƒ½
- æ”¶é›†ç”¨æˆ·åé¦ˆæŒç»­æ”¹è¿›

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Prometheusæ•°æ®æºé…ç½®æ­£ç¡®
2. æœåŠ¡æŒ‡æ ‡ç«¯ç‚¹æ­£å¸¸è®¿é—®
3. Grafanaç‰ˆæœ¬å…¼å®¹æ€§
4. ç½‘ç»œè¿æ¥çŠ¶æ€

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-11-24)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ”§ 4ä¸ªæ ¸å¿ƒç›‘æ§ä»ªè¡¨æ¿
- ğŸ“Š å…¨é¢çš„ä¸šåŠ¡æŒ‡æ ‡è¦†ç›–
- ğŸ›¡ï¸ å®‰å…¨ç›‘æ§å’Œæƒé™ç®¡ç†
- âš¡ å®æ—¶æ€§èƒ½ç›‘æ§
- ğŸ“ˆ è¿è¥åˆ†æå’ŒKPIæŒ‡æ ‡